<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://tronprotocol.github.io/documentation-zh/mechanism-algorithm/multi-signatures/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>多重签名 - Java Tron</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "\u591a\u91cd\u7b7e\u540d";
        var mkdocs_page_input_path = "mechanism-algorithm/multi-signatures.md";
        var mkdocs_page_url = "/documentation-zh/mechanism-algorithm/multi-signatures/";
      </script>
    
    <script src="../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Java Tron
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">入门</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../getting_started/getting_started_with_javatron/">Java-tron入门</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">使用Java-tron</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../using_javatron/installing_javatron/">部署Java-tron</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../using_javatron/backup_restore/">备份和恢复</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../developers/litefullnode/">轻节点</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../using_javatron/private_network/">私链网络</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../architecture/event/">事件订阅</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../architecture/database/">数据库配置</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../using_javatron/connecting_to_tron/">网络配置</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../using_javatron/metrics/">节点监控</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../using_javatron/toolkit/">节点维护工具</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API 接口</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../api/http/">HTTP 接口</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../api/rpc/">gRPC 接口</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">核心协议</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../../introduction/dpos/">波场共识</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../sr/">超级代表</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../account/">账户模型</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../resource/">资源模型</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../contracts/contract/">智能合约</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../system-contracts/">系统合约</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../dex/">去中心化交易所</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">多重签名</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#_2">背景</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#_3">概念说明</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#_4">结构说明</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#account">Account</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#contracttype">ContractType</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#accountpermissionupdatecontract">AccountPermissionUpdateContract</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#permission">Permission</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#key">Key</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#transaction">Transaction</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#owner">Owner权限</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#witness">Witness权限</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#active">Active权限</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#_5">费用</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#api">API</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#_6">修改权限</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#http-demo">http-demo</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#activeoperations">active权限中operations的计算示例</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#_7">执行合约</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#_8">其他相关接口</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#_9">查询已签名地址</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#_10">查询交易签名权重</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Java-tron开发</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../developers/java-tron/">开发者指南</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../developers/tips/">TIPs工作流程</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../developers/issue-workflow/">Issue工作流程</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../developers/governance/">治理流程</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../developers/run-in-idea/">配置IDE开发环境</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../developers/demo/">开发示例</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../developers/code-structure/">核心模块</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Dapp开发</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../contracts/compiler/">Dapp开发工具</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Wallet-cli</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../clients/wallet-cli/">什么是Wallet-Cli</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../clients/wallet-cli-command/">Wallet命令</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">版本发布</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../releases/upgrade-instruction/">新版本部署手册</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../releases/signature_verification/">一致性检验</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../releases/history/">历史版本</a>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../glossary/">术语表</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Java Tron</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>核心协议 &raquo;</li><li>多重签名</li>
    <li class="wy-breadcrumbs-aside">
        <a href="https://github.com/tronprotocol/documentation-zh/edit/master/docs/mechanism-algorithm/multi-signatures.md"
          class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>

          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="_1">多重签名<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h1>
<h2 id="_2">背景<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>多重签名功能允许权限分级，每个权限可以对应多个私钥。这使得实现账户的多人联合控制成为可能。</p>
<p><a href="https://github.com/tronprotocol/tips/blob/master/tip-16.md">Tron multi-signatures TIP</a></p>
<h2 id="_3">概念说明<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<p>该方案共包含三种权限级别，owner、witness以及active权限，其中owner权限具有执行所有合约的权限，witness权限用于超级代表出块，active是自定义权限(可以组合权限集合)，以下将详细说明。</p>
<h3 id="_4">结构说明<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<h4 id="account">Account<a class="headerlink" href="#account" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="kd">message</span><span class="w"> </span><span class="nc">Account</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="o">...</span>
<span class="w">  </span><span class="n">Permission</span><span class="w"> </span><span class="na">owner_permission</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">31</span><span class="p">;</span>
<span class="w">  </span><span class="n">Permission</span><span class="w"> </span><span class="na">witness_permission</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">32</span><span class="p">;</span>
<span class="w">  </span><span class="k">repeated</span><span class="w"> </span><span class="n">Permission</span><span class="w"> </span><span class="na">active_permission</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">33</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>在账户结构中有三个权限属性，分别是 owner_permission、witness_permission 和 active_permission，其中 active_permission 是个列表，可以指定最多8个。</p>
<h4 id="contracttype">ContractType<a class="headerlink" href="#contracttype" title="Permanent link">&para;</a></h4>
<p><div class="highlight"><pre><span></span><code><span class="kd">message</span><span class="w"> </span><span class="nc">Transaction</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">message</span><span class="w"> </span><span class="nc">Contract</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">enum</span><span class="w"> </span><span class="n">ContractType</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="na">AccountCreateContract</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">      </span><span class="o">...</span>
<span class="w">      </span><span class="na">AccountPermissionUpdateContract</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">46</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
AccountPermissionUpdateContract类型的交易，用于更新账户权限。</p>
<h4 id="accountpermissionupdatecontract">AccountPermissionUpdateContract<a class="headerlink" href="#accountpermissionupdatecontract" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="kd">message</span><span class="w"> </span><span class="nc">AccountPermissionUpdateContract</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">bytes</span><span class="w"> </span><span class="na">owner_address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="n">Permission</span><span class="w"> </span><span class="na">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">  </span><span class="n">Permission</span><span class="w"> </span><span class="na">witness</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="w">  </span><span class="k">repeated</span><span class="w"> </span><span class="n">Permission</span><span class="w"> </span><span class="na">actives</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p><code>owner_address</code>：待修改权限的账户的地址
<code>owner</code>：修改后的 owner 权限
<code>witness</code>：修改后的 witness 权限（如果是 witness ）
<code>actives</code>：修改后的 actives 权限</p>
<p>注意：该接口是覆盖原账户权限，因此，如果只想修改owner权限，witness（如果是witnss账户）及actives的也需要设置。</p>
<h4 id="permission">Permission<a class="headerlink" href="#permission" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="kd">message</span><span class="w"> </span><span class="nc">Permission</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">enum</span><span class="w"> </span><span class="n">PermissionType</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">Owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="na">Witness</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="na">Active</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">PermissionType</span><span class="w"> </span><span class="na">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int32</span><span class="w"> </span><span class="na">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="na">permission_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int64</span><span class="w"> </span><span class="na">threshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int32</span><span class="w"> </span><span class="na">parent_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
<span class="w">  </span><span class="kt">bytes</span><span class="w"> </span><span class="na">operations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">;</span>
<span class="w">  </span><span class="k">repeated</span><span class="w"> </span><span class="n">Key</span><span class="w"> </span><span class="na">keys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p><code>PermissionType</code>: 权限类型，目前仅支持三种权限
<code>id</code>: 值由系统自动设置，Owner id=0, Witness id=1, Active id 从2开始递增分配。在执行合约时，
通过该id来指定使用哪个权限，如使用owner权限，即将id设置为0。
<code>permission_name</code>: 权限名称，由用户设定，长度限制为32字节
<code>threshold</code>: 阈值，只有当参与签名的权重之和超过域值才允许做相应的操作。要求小于Long类型的最大值
<code>parent_id</code>：目前只能为0
<code>operations</code>：共32字节（256位），每位代表一个合约的权限，为1时表示拥有该合约的权限。
如<code>operations=0x0100...00(十六进制),即100...0(二进制)</code>时,查看proto中Transaction.ContractType定义，合约AccountCreateContract的id为0，
即表示该permission只拥有执行AccountCreateContract的权限，可以使用"active权限中operations的计算示例"计算获得。
<code>keys</code>：共同拥有该权限的地址及权重，最多允许5个key。</p>
<h4 id="key">Key<a class="headerlink" href="#key" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="kd">message</span><span class="w"> </span><span class="nc">Key</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">bytes</span><span class="w"> </span><span class="na">address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int64</span><span class="w"> </span><span class="na">weight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p><code>address</code>：拥有该权限的地址
<code>weight</code>：该地址对该权限拥有权重</p>
<h4 id="transaction">Transaction<a class="headerlink" href="#transaction" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="kd">message</span><span class="w"> </span><span class="nc">Transaction</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="o">...</span>
<span class="w">  </span><span class="kt">int32</span><span class="w"> </span><span class="na">Permission_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>在交易中增加 <code>Permission_id</code>字段，与<code>Permission.id</code>相对应，用于指定使用哪个权限。默认为0，即owner权限。
不允许为1，因为witness权限仅用于出块，不用于对交易进行签名。</p>
<h3 id="owner">Owner权限<a class="headerlink" href="#owner" title="Permanent link">&para;</a></h3>
<p>OwnerPermission是账户的最高权限，用于控制用户的所有权、调整权限结构，Owner权限也可以执行所有合约。</p>
<p>Owner权限具有以下特性：
1、拥有OwnerPermission的地址可以修改OwnerPermission。
2、当OwnerPermission为空时，默认采用该账户的地址具有owner权限。
3、账户新建时，自动将该账户的地址填充到OwnerPermission中，并默认域值为1，keys中仅包含该账户地址且权重为1。
4、当执行合约时未指定permissionId时， 默认采用OwnerPermission。</p>
<h3 id="witness">Witness权限<a class="headerlink" href="#witness" title="Permanent link">&para;</a></h3>
<p>超级代表可使用该权限，管理出块节点。非witness账户无该权限。</p>
<p>使用场景示例：一个超级代表在云服务器上部署出块程序，为了账户安全，此时可以将出块权限赋予另一个地址。由于该地址仅具有出块权限，无TRX转出权限，即使该服务器上私钥被泄密，也不会出现TRX丢失。</p>
<p>Witness出块节点的配置：
1、未修改witness权限时，无需特殊配置。
2、修改witness权限后的出块节点，需要在重新配置，配置项如下：</p>
<div class="highlight"><pre><span></span><code>#config.conf

// Optional.The default is empty.
// It is used when the witness account has set the witnessPermission.
// When it is not empty, the localWitnessAccountAddress represents the address of the witness account,
// and the localwitness is configured with the private key of the witnessPermissionAddress in the witness account.
// When it is empty,the localwitness is configured with the private key of the witness account.
//可选项，默认为空。
//用于当witness账户设置了witnessPermission。
//当该值不为空时，localWitnessAccountAddress代表witness账户的地址，localwitness是witnessPermission中的地址的私钥。
//当该值为空时，localwitness配置为witness账户的私钥。

//localWitnessAccountAddress =

localwitness = [
  f4df789d3210ac881cb900464dd30409453044d2777060a0c391cbdf4c6a4f57
]
</code></pre></div>
<h3 id="active">Active权限<a class="headerlink" href="#active" title="Permanent link">&para;</a></h3>
<p>Active权限，用于提供一个权限的组合，比如提供一个只能执行创建账户、转账功能的权限。</p>
<p>Active权限有以下特性：
1、拥有OwnerPermission的地址可以修改Active权限
2、拥有执行AccountPermissionUpdateContract权限的地址也能够修改Active权限
3、最多支持8个组合。
4、permission的id从2开始自动递增。
5、账户新建时，自动创建一个Active权限，并将该账户的地址填充到其中，默认域值为1，keys中仅包含该账户地址且权重为1。</p>
<h3 id="_5">费用<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<ol>
<li>使用更新账户权限时，即 AccountPermissionUpdate 合约，收取100TRX。</li>
<li>使用多重签名的交易时，即交易中包括两个及两个以上签名的交易，除交易费用外，另收取1TRX。</li>
<li>可通过提议，修改以上费用。</li>
</ol>
<h2 id="api">API<a class="headerlink" href="#api" title="Permanent link">&para;</a></h2>
<h3 id="_6">修改权限<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<p><code>AccountPermissionUpdateContract</code>，修改权限步骤如下：</p>
<p>1、使用接口<code>getaccount</code>查询账户，并获取原权限
2、修改permission
3、创建合约，签名
4、发送交易</p>
<h3 id="http-demo">http-demo<a class="headerlink" href="#http-demo" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">h</span><span class="kc">tt</span><span class="err">p</span><span class="p">:</span><span class="c1">//{{host}}:{{port}}/wallet/accountpermissionupdate</span>


<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;owner_address&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;41ffa9466d5bf6bb6b7e4ab6ef2b1cb9f1f41f9700&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;permission_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;owner&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;threshold&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;keys&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">        </span><span class="nt">&quot;address&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;41F08012B4881C320EB40B80F1228731898824E09D&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;weight&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;address&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;41DF309FEF25B311E7895562BD9E11AAB2A58816D2&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;weight&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;address&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;41BB7322198D273E39B940A5A4C955CB7199A0CDEE&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;weight&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;witness&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;permission_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;witness&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;threshold&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;keys&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">          </span><span class="nt">&quot;address&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;41F08012B4881C320EB40B80F1228731898824E09D&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;weight&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;actives&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;permission_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;active0&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;threshold&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;operations&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;7fff1fc0037e0000000000000000000000000000000000000000000000000000&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;keys&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">        </span><span class="nt">&quot;address&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;41F08012B4881C320EB40B80F1228731898824E09D&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;weight&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;address&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;41DF309FEF25B311E7895562BD9E11AAB2A58816D2&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;weight&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;address&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;41BB7322198D273E39B940A5A4C955CB7199A0CDEE&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;weight&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}]</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="activeoperations">active权限中operations的计算示例<a class="headerlink" href="#activeoperations" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="c1">//指定需要支持的合约id(查看proto中Transaction.ContractType定义)，这里包含除AccountPermissionUpdateContract（id=46）以外的所有合约</span>
<span class="w">  </span><span class="n">Integer</span><span class="o">[]</span><span class="w"> </span><span class="n">contractId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="mi">17</span><span class="p">,</span><span class="w"> </span><span class="mi">18</span><span class="p">,</span><span class="w"> </span><span class="mi">19</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="mi">31</span><span class="p">,</span>
<span class="w">      </span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="mi">41</span><span class="p">,</span><span class="w"> </span><span class="mi">42</span><span class="p">,</span><span class="w"> </span><span class="mi">43</span><span class="p">,</span><span class="w"> </span><span class="mi">44</span><span class="p">,</span><span class="w"> </span><span class="mi">45</span><span class="p">};</span>
<span class="w">  </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="n">contractId</span><span class="p">));</span>
<span class="w">  </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">operations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">byte</span><span class="o">[</span><span class="mi">32</span><span class="o">]</span><span class="p">;</span>
<span class="w">  </span><span class="n">list</span><span class="p">.</span><span class="na">forEach</span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">operations</span><span class="o">[</span><span class="n">e</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">8</span><span class="o">]</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">8</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="c1">//7fff1fc0033e0000000000000000000000000000000000000000000000000000</span>
<span class="w">  </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">ByteArray</span><span class="p">.</span><span class="na">toHexString</span><span class="p">(</span><span class="n">operations</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="_7">执行合约<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h3>
<p>1、创建交易，与非多重签名交易的构建过程相同
2、指定Permission_id，默认为0，表示owner-permission, <a href="https://github.com/tronprotocol/wallet-cli/commit/ff9122f2236f1ce19cbb9ba9f0494c8923a3d10c#diff-a63fa7484f62fe1d8fb27276c991a4e3R211">demo</a>
3、用户A签名，将签名后交易通过其他方式发送给B。
4、用户B签名，将签名后交易通过其他方式发送给C。
…
n、最后一个完成签名的用户，将交易广播到节点。
n+1、验证多重签名的权重之和大于域值则接受交易，否则拒绝交易</p>
<p>代码示例：</p>
<p><a href="https://github.com/tronprotocol/wallet-cli/blob/multi_sign_V2/src/main/java/org/tron/demo/MultiSignDemo.java">多重签名示例</a></p>
<h3 id="_8">其他相关接口<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h3>
<h4 id="_9">查询已签名地址<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>curl -X POST  http://127.0.0.1:8090/wallet/getapprovedlist -d &#39;{&quot;transaction&quot;}&#39;

rpc GetTransactionApprovedList(Transaction) returns (TransactionApprovedList) { }
</code></pre></div>
<h4 id="_10">查询交易签名权重<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w">  </span>http://127.0.0.1:8090/wallet/getsignweight<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;transaction&quot;}&#39;</span>

rpc<span class="w"> </span>GetTransactionSignWeight<span class="w"> </span><span class="o">(</span>Transaction<span class="o">)</span><span class="w"> </span>returns<span class="w"> </span><span class="o">(</span>TransactionSignWeight<span class="o">)</span><span class="w"> </span><span class="o">{}</span>
</code></pre></div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../dex/" class="btn btn-neutral float-left" title="去中心化交易所"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../../developers/java-tron/" class="btn btn-neutral float-right" title="开发者指南">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/tronprotocol/documentation-zh" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../dex/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../../developers/java-tron/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
